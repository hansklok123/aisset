
<!DOCTYPE html>

<html lang="nl">
<head><meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta charset="utf-8"/>
<title>ETD Overzicht</title>
<style>
    body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 1rem; }
    h2 { color: #003b5c; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.5rem; border: 1px solid #ccc; }
    th { background-color: #003b5c; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    button { margin-top: 1rem; padding: 0.5rem 1rem; }
  
    body {
      background: url('https://storage.rotterdammaritimecapital.com/storage/2018/08/01152337/RMCOE_Port-and-Logistics.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      padding: 1rem;
    }

    h2 {
      color: white;
      text-align: center;
    }

    table {
      background-color: rgba(255,255,255,0.95);
      color: #000;
      font-size: 0.9rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      display: block;
    }

    th {
      background-color: #003b5c;
      color: white;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    button {
      background-color: #003b5c;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      width: 100%;
      margin-top: 1rem;
      font-size: 1rem;
    }
    
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('https://keystoneacademic-res.cloudinary.com/image/upload/f_auto/q_auto/g_auto/w_724/dpr_2.0/element/11/119872_rotterdam-4152380_1920.jpg') no-repeat center center fixed;
      background-size: cover;
      z-index: -1;
      animation: achtergrondFade 30s ease-in-out infinite alternate;
    }

    @keyframes achtergrondFade {
      0%   { filter: brightness(1); }
      100% { filter: brightness(0.93); }
    }

    .content-box {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    .logo {
      display: block;
      margin: 1rem auto 0 auto;
      width: 100px;
      height: 70px;
    }

    h2 {
      margin-top: 0.5rem;
    }
    
    #zoek {
      padding: 0.5rem;
      width: 250px;
      border-radius: 1rem;
      border: 1px solid #ccc;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2);
    }

    .filter-buttons {
      margin-top: 0.5rem;
    }

    .filter-buttons button {
      padding: 0.5rem 0.75rem;
      margin-right: 0.5rem;
      border: none;
      background: #003b5c;
      color: white;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .filter-buttons button:hover {
      background: #005080;
    }
    
    th[onclick]:hover {
      background-color: rgba(0, 59, 92, 0.1);
    }
    
    .dashboard-box {
      background-color: rgba(0, 0, 0, 0.50);
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 1rem;
      max-width: 95%;
      margin: 2rem auto;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }

    table {
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
      border: 1px solid #ccc;
    }
    </style>
</head>
<body>

<img alt="logo" class="logo" src="https://hansklok123.github.io/aisset/logo.png"/>
<script>
    async function laad() {
      const res = await fetch("/data/submissions.json");
      const data = await res.json();
      const tbody = document.querySelector("tbody");
      tbody.innerHTML = "";
      data.forEach(r => {
        const rij = document.createElement("tr");
        rij.innerHTML = `<td>${r.Scheepsnaam}, ${r.ScheepsnaamHandmatig}</td><td>${r.ETD}</td><td>${r.RedenGeenETD}</td><td>${r.Toelichting}</td><td>${r.Timestamp}</td><td>${r.Latitude}</td><td>${r.Longitude}</td>`;
        tbody.appendChild(rij);
      });
    }

    async function exporteer(type) {
      const res = await fetch("/admin/export?type=" + type);
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "etd-export." + type;
      link.click();
    }

    laad();
  </script>
<script>
function exporteerCSV() {
  const rows = Array.from(document.querySelectorAll("table tr"));
  const csv = rows.map(row => {
    return Array.from(row.querySelectorAll("th,td"))
      .map(cell => `"${cell.textContent.trim()}"`).join(",");
  }).join("\n");

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "etd-export.csv";
  a.click();
}
</script>
<script>
let origineleData = [];

async function laad() {
  const res = await fetch("/data/submissions.json");
  const data = await res.json();
  origineleData = data;
  toonData(data);
}

function toonData(data) {
  const tbody = document.querySelector("tbody");
  tbody.innerHTML = "";
  data.forEach(r => {
    const rij = document.createElement("tr");
    rij.innerHTML = `<td>${r.Scheepsnaam}</td><td>${r.ETD}</td><td>${r.RedenGeenETD}</td><td>${r.Toelichting}</td><td>${r.Timestamp}</td><td>${r.Latitude}</td><td>${r.Longitude}</td>`;
    tbody.appendChild(rij);
  });
}

function sorteerOp(veld) {
  const gesorteerd = [...origineleData].sort((a, b) => {
    if (!a[veld]) return 1;
    if (!b[veld]) return -1;
    return a[veld].localeCompare(b[veld]);
  });
  toonData(gesorteerd);
}

function filterOpZoekterm() {
  const zoekterm = document.getElementById("zoek").value.toLowerCase();
  const gefilterd = origineleData.filter(r =>
    r.Scheepsnaam?.toLowerCase().includes(zoekterm) ||
    r.ETD?.toLowerCase().includes(zoekterm) ||
    r.Timestamp?.toLowerCase().includes(zoekterm)
  );
  toonData(gefilterd);
}

window.onload = laad;
</script><script>
async function updateProgress() {
  const res = await fetch("/data/submissions.json");
  const data = await res.json();
  const count = data.length;
  const max = 200;
  const percentage = Math.min(100, (count / max) * 100);
  const bar = document.getElementById("progressbar");
  const display = document.getElementById("dataCount");
  bar.style.width = percentage + "%";
  display.textContent = count + " schepen";

  const groen = Math.min(255, Math.floor((percentage / 100) * 255));
  const rood = 255 - groen;
  bar.style.backgroundColor = `rgb(${rood}, ${groen}, 0)`;
}

updateProgress();
</script><div class="dashboard-box"><div style="margin: 1rem auto; max-width: 600px;">
<label style="color: white; font-weight: bold;">Verzamelde datapunten</label>

<div id="dataCount" style="text-align: right; color: white; margin-top: 0.3rem;">0 schepen</div>
</div><div style="background-color: #ccc; border-radius: 1rem; height: 20px; overflow: hidden;">
<div id="progressbar" style="height: 100%; width: 0%; background-color: red; transition: width 0.5s;"></div>
</div><div class="filter-section" style="text-align: center; margin: 1rem 0;"></div><div class="filter-section" style="text-align: center; margin: 1rem 0;">
  ðŸ”Ž <input id="zoek" oninput="filterOpZoekterm()" placeholder="Filter op scheepsnaam, datum of tijd" style="padding: 0.5rem; width: 60%;" type="text"/>
</div><table id="tabel">
<thead>
<tr>
<th onclick="sorteerOp('Scheepsnaam')" style="cursor: pointer;">Scheepsnaam â–²â–¼</th><th onclick="sorteerOp('ETD')" style="cursor: pointer;">ETD â–²â–¼</th><th onclick="sorteerOp('ETD')" style="cursor: pointer;">ETD â–²â–¼</th><th>Toelichting</th><th onclick="sorteerOp('Timestamp')" style="cursor: pointer;">Tijd â–²â–¼</th><th>Latitude</th><th>Longitude</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- SheetJS bibliotheek toevoegen -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<div style="width:100%;text-align:right;margin-top:2em;">
    <button id="exportExcelBtn" style="padding: 0.5em 1.5em; border-radius: 8px; background: #217346; color: #fff; border: none; cursor: pointer;">Exporteer naar Excel</button>
</div>
<script>
document.getElementById('exportExcelBtn').onclick = function() {
    var table = document.querySelector('table');
    var wb = XLSX.utils.table_to_book(table, {sheet:"ETD export"});
    XLSX.writeFile(wb, 'etd-export.xlsx');
};
</script>



</div></body>
</html>

<script>
// Voeg samen de kolommen Scheepsnaam en Handmatig_Scheepsnaam (als die bestaan)
document.addEventListener("DOMContentLoaded", function() {
    var table = document.querySelector('table');
    if(!table) return;
    // Zoek kolom-indexen
    var headers = table.rows[0].cells;
    var idxScheepsnaam = -1, idxHandmatig = -1;
    for(let i=0; i<headers.length; i++) {
        if(headers[i].innerText.trim().toLowerCase().includes("scheepsnaam")) idxScheepsnaam = i;
        if(headers[i].innerText.trim().toLowerCase().includes("handmatig")) idxHandmatig = i;
    }
    if(idxScheepsnaam === -1 || idxHandmatig === -1) return;
    // Voeg samen in scheepsnaam-kolom
    for(let r=1; r<table.rows.length; r++) {
        let c1 = table.rows[r].cells[idxScheepsnaam].innerText.trim();
        let c2 = table.rows[r].cells[idxHandmatig].innerText.trim();
        table.rows[r].cells[idxScheepsnaam].innerText = (c1 && c2) ? c1 + " " + c2 : (c1 || c2);
    }
});
</script>
